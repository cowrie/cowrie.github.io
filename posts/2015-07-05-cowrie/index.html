<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>Cowrie Honeypot | Cowrie</title>
<meta name=viewport content="width=device-width,minimum-scale=1">
<meta name=description content="Since summer 2014 I&rsquo;ve been working on extensions and contributions to the well known Kippo honeypotdeveloped by desaster.
I noticed some SSH attacks against my systems were not logged in full detail and I started to work on additional logging, from there I&rsquo;ve added &lsquo;ssh exec commands&rsquo; support, SFTP support, SCP support, direct-tcpip (proxying) support and many other features.
To distinguish this from the original software, I have now renamed the system to &#34;Cowrie&#34;.">
<meta name=generator content="Hugo 0.91.2">
<meta name=robots content="noindex, nofollow">
<link rel=stylesheet href=/ananke/css/main.min.css>
<link rel=stylesheet href=/asciinema-player.css>
<meta property="og:title" content="Cowrie Honeypot">
<meta property="og:description" content="Since summer 2014 I&rsquo;ve been working on extensions and contributions to the well known Kippo honeypotdeveloped by desaster.
I noticed some SSH attacks against my systems were not logged in full detail and I started to work on additional logging, from there I&rsquo;ve added &lsquo;ssh exec commands&rsquo; support, SFTP support, SCP support, direct-tcpip (proxying) support and many other features.
To distinguish this from the original software, I have now renamed the system to &#34;Cowrie&#34;.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.cowrie.org/posts/2015-07-05-cowrie/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2015-07-05T00:00:00+00:00">
<meta property="article:modified_time" content="2015-07-05T00:00:00+00:00">
<meta itemprop=name content="Cowrie Honeypot">
<meta itemprop=description content="Since summer 2014 I&rsquo;ve been working on extensions and contributions to the well known Kippo honeypotdeveloped by desaster.
I noticed some SSH attacks against my systems were not logged in full detail and I started to work on additional logging, from there I&rsquo;ve added &lsquo;ssh exec commands&rsquo; support, SFTP support, SCP support, direct-tcpip (proxying) support and many other features.
To distinguish this from the original software, I have now renamed the system to &#34;Cowrie&#34;."><meta itemprop=datePublished content="2015-07-05T00:00:00+00:00">
<meta itemprop=dateModified content="2015-07-05T00:00:00+00:00">
<meta itemprop=wordCount content="1224">
<meta itemprop=keywords content="ssh,cowrie,honeypot,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Cowrie Honeypot">
<meta name=twitter:description content="Since summer 2014 I&rsquo;ve been working on extensions and contributions to the well known Kippo honeypotdeveloped by desaster.
I noticed some SSH attacks against my systems were not logged in full detail and I started to work on additional logging, from there I&rsquo;ve added &lsquo;ssh exec commands&rsquo; support, SFTP support, SCP support, direct-tcpip (proxying) support and many other features.
To distinguish this from the original software, I have now renamed the system to &#34;Cowrie&#34;.">
</head>
<body class="ma0 avenir bg-near-white">
<header class="cover bg-top" style=background-image:url(https://www.cowrie.org/images/kippo-bg.jpg)>
<div class=bg-black-60>
<nav class="pv3 ph3 ph4-ns" role=navigation>
<div class="flex-l justify-between items-center center">
<a href=/ class="f3 fw2 hover-white no-underline white-90 dib">
Cowrie
</a>
<div class="flex-l items-center">
<ul class="pl0 mr3">
<li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=/contact/ title="Contact page">
Contact
</a>
</li>
<li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=/download/ title="Download page">
Download
</a>
</li>
<li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=/mail/ title="Mailing List page">
Mailing List
</a>
</li>
<li class="list f5 f4-ns fw4 dib pr3">
<a class="hover-white no-underline white-90" href=/posts/ title="Posts page">
Posts
</a>
</li>
</ul>
<div class=ananke-socials>
<a href=https://twitter.com/micheloosterhof target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window">
<span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</span>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</span></a>
<a href=https://github.com/cowrie/cowrie target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window">
<span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
</span>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</span></a>
</div>
</div>
</div>
</nav>
<div class="tc-l pv6 ph3 ph4-ns">
<h1 class="f2 f1-l fw2 white-90 mb0 lh-title">Cowrie Honeypot</h1>
</div>
</div>
</header>
<main class=pb7 role=main>
<article class="flex-l flex-wrap justify-between mw8 center ph3">
<header class="mt4 w-100">
<aside class="instapaper_ignoref b helvetica tracked">
POSTS
</aside>
<div id=sharing class="mt3 ananke-socials">
<a href="https://twitter.com/share?url=https://www.cowrie.org/posts/2015-07-05-cowrie/&text=Cowrie%20Honeypot" class="ananke-social-link twitter no-underline" aria-label="share on Twitter">
<span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</span>
</a>
</div>
<h1 class="f1 athelas mt3 mb1">Cowrie Honeypot</h1>
<p class=tracked>
By <strong>Michel Oosterhof</strong>
</p>
<time class="f6 mv4 dib tracked" datetime=2015-07-05T00:00:00Z>July 5, 2015</time>
</header>
<div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>Since summer 2014 I&rsquo;ve been working on extensions and contributions to the well known
Kippo honeypot developed by
desaster.</p>
<p>I noticed some SSH attacks against my systems were not logged in full detail and I started to work on additional logging,
from there I&rsquo;ve added &lsquo;ssh exec commands&rsquo; support, SFTP support, SCP support, direct-tcpip (proxying) support and many other features.</p>
<p>To distinguish this from the original software, I have now renamed the system to "Cowrie".
All features below are incorporated in my cowrie repository on github.</p>
<h1 id=new-features>New Features</h1>
<h2 id=sftp-support>SFTP support</h2>
<p>Cowrie now supports the SFTP protocol to upload and download files. Uploaded files are placed into the &lsquo;dl/&rsquo; directory, like files that were downloaded by &lsquo;wget&rsquo;.
SFTP offers a file system interface to the pickled fs and you can list any file available in there. Downloads are also supported, if the contents are in honeyfs.
Programmatically it is based on the Twisted Conch code, and uses a UNIX file system like interface to the pickled file system.</p>
<h2 id=exec-support>Exec support</h2>
<p>One way to run remote commands is &lsquo;exec&rsquo; commands. Like so:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ssh user@host <span style=color:#e6db74>&#39;cat /etc/passwd&#39;</span></code></pre></div>
<p>Support for this has been merged into the original Kippo repository, so it&rsquo;s probably already in your version. This includes logging and executing these commands.</p>
<p>I&rsquo;ve seen other uses as well, where malicious code is uploaded through stdin. Less common now, but I did see this last year:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cat malware | ssh user@host <span style=color:#e6db74>&#39;cat&gt;./malware;chmod u+x ./malware; ./malware; rm -f ./malware&#39;</span>. </code></pre></div>
<p>So I added &lsquo;stdin&rsquo; logging whenever standard-in data is encountered in combination with an exec command.</p>
<h2 id=ssh-tunnelling-direct-tcpip-support>SSH tunnelling (direct-tcpip) support</h2>
<p>I added logging initially for additional channels and saw I received some &lsquo;direct-tcpip&rsquo; requests.
This is the TCP/IP tunneling through SSH. After some more modifications, kippo now pretends
to accept these requests so it can log the initial connection data. This is often HTTP, but sometimes SSL, BitTorrent and sometimes something else.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>2015-02-09 04:48:08+0000 [SSHService ssh-userauth on HoneyPotTransport,1151,130.211.164.xx] ubnt trying auth password
2015-02-09 04:48:08+0000 [SSHService ssh-userauth on HoneyPotTransport,1151,130.211.164.xx] login attempt [ubnt/ubnt] succeeded
2015-02-09 04:48:08+0000 [SSHService ssh-userauth on HoneyPotTransport,1151,130.211.164.xx] ubnt authenticated with password
2015-02-09 04:48:08+0000 [SSHService ssh-userauth on HoneyPotTransport,1151,130.211.164.xx] starting service ssh-connection
2015-02-09 04:48:08+0000 [SSHService ssh-connection on HoneyPotTransport,1151,130.211.164.xx] got channel direct-tcpip request
2015-02-09 04:48:08+0000 [SSHService ssh-connection on HoneyPotTransport,1151,130.211.164.xx] direct-tcp connection attempt to 95.211.125.236:80
2015-02-09 04:48:08+0000 [SSHChannel None (0) on SSHService ssh-connection on HoneyPotTransport,1151,130.211.164.xx] Faking channel open 95.211.125.236:80
2015-02-09 04:48:09+0000 [SSHChannel None (0) on SSHService ssh-connection on HoneyPotTransport,1151,130.211.164.xx] received data &#39;POST http://www.ip-score.com/ajax_handler/check_pbl HTTP/1.1\r\nHost: www.ip-score.com\r\nUser-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:29.0) Gecko/20100101 Firefox/29.0\r\nReferer: http://www.ip-score.com/\r\nX-Requested-With: XMLHttpRequest\r\nConnection: Keep-Alive\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length: 0\r\n\r\n&#39;</code></pre></div>
<h2 id=ssh-fingerprint-logging>SSH Fingerprint logging</h2>
<p>Some adversaries have (accidently?) public keys configured on their attack hosts. The SSH client attempts to login with this public key.
Cowrie now accept, logs and then denies public-key authentication. An easy way to fingerprint (sic) attackers.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>2014-11-15 00:26:11+0000 [SSHService ssh-userauth on HoneyPotTransport,206,193.104.41.***] Public Key attempt for user admin with fingerprint b4:2b:f0:30:3a:97:04:90:b1:99:47:b4:7b:89:56:xx:</code></pre></div>
<h2 id=ssh-protocol-updates>SSH Protocol Updates</h2>
<p>I&rsquo;ve enabled the diffie-hellman-group-exchange-sha1 algorithm. And updated the ciphers to the ones supported by OpenSSH.
Als added &lsquo;dss&rsquo; keys.</p>
<p>Also I ported code from honssh to stop the Metasploit kippo detection by Andrew Morris. The issue is more with Conch (the Twisted SSH implementation), but there&rsquo;s a workaround in Cowrie now.</p>
<p>It&rsquo;s good to realize that Cowrie is a medium interaction honeypot, and there will always be ways to fingerprint the honeypot. Another easy way is to look just at the ciphers offered by the SSH server.</p>
<h2 id=additional-commands>Additional commands</h2>
<p>I added additional commmands:</p>
<ul>
<li>sleep</li>
<li>sync</li>
<li>chattr</li>
<li>uname -r</li>
<li>dir</li>
<li>help</li>
<li>poweroff</li>
<li>jobs</li>
<li>halt</li>
<li>reboot</li>
<li>users</li>
<li>lscpu</li>
<li>killall</li>
<li>killall5</li>
<li>reset</li>
</ul>
<h2 id=exit-status>Exit status</h2>
<p>SSH has a way to transfer the exit status of the remote command back to the original host. This is called exit status.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ssh -p <span style=color:#ae81ff>2222</span> root@host ls /
bin        boot       dev        etc        home       initrd.img lib
lost+found media      mnt        opt        proc       root       run
sbin       selinux    srv        sys        tmp        usr        var
vmlinuz
$ echo $?
<span style=color:#ae81ff>0</span></code></pre></div>
<p>Original kippo sends no exit status.
Cowrie always sends a &lsquo;0&rsquo; exit code signifying succes, regardless of the command that&rsquo;s executed.</p>
<h2 id=command-line-support>Command line support</h2>
<p>Cowrie supports additional emacs keybindings such as ctrl-a (start of line), ctrl-e (end of line), ctrl-p (previous command), ctrl-n (next command),
ctrl-b (one character left) and ctrl-f (one character forward)</p>
<h2 id=ported-kippo-extra>Ported kippo-extra</h2>
<p>I added &lsquo;which&rsquo;, &lsquo;netstat&rsquo;, &lsquo;gcc&rsquo; from kippo-extra by basilfx.</p>
<h2 id=usernames-and-passwords>Usernames and passwords.</h2>
<p>I added wildcard support for the password database. Passwords can now be &lsquo;*&rsquo; to allow any password. There&rsquo;s also a &lsquo;!&rsquo; operator to deny explicit passwords.
The rules are evaluated in order, so the &lsquo;*&rsquo; should usually come last. My userdb is now:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>root:0:!root
root:0:!123456
root:0:*
oracle:0:*
ubnt:500:ubnt
admin:500:!admin
admin:500:*
mysql:0:*
hadoop:0:*
guest:0:*</code></pre></div>
<h2 id=miscellaneous>Miscellaneous</h2>
<ul>
<li>&lsquo;ls&rsquo; output is now alphabetical</li>
<li>&lsquo;wget&rsquo; allowed to http using non-80 ports</li>
<li>disabled the &lsquo;exit-jail&rsquo; that gave people the fake &lsquo;localhost&rsquo; prompt after logout</li>
<li>Fixed ability to ping IP addresses like 555.555.555.555</li>
<li>The bannerfile is now always &lsquo;&lt;honeyfs>>/etc/issue.net&rsquo;.</li>
</ul>
<h2 id=hpfeeds>HPFeeds</h2>
<p>I added hpeeds.py from threatstream&rsquo;s repository. It uses sockets and no deferred and should not work all that well with
Twisted&rsquo;s asynchronous system, but in practice people use it.</p>
<h2 id=json-logging>JSON logging</h2>
<p>I&rsquo;m in the process of converting Cowrie to more structured logging and a new dblog framework
that&rsquo;s more extensible. One result so far is a JSON dblog plugin.
This logs the same information as the general dblog modules, but in JSON format, so it can be easily picked up by log analysis tools.
It writes timestamps in UTC with microseconds and adds a unique UUID session identifier to each log entry. It also adds
argument as their own JSON attributes so text log parsing is no longer necessary.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{<span style=color:#f92672>&#34;src_ip&#34;</span>: <span style=color:#e6db74>&#34;127.0.0.1&#34;</span>, <span style=color:#f92672>&#34;timestamp&#34;</span>: <span style=color:#e6db74>&#34;2015-02-04T06:40:00.067897Z&#34;</span>, <span style=color:#f92672>&#34;message&#34;</span>: <span style=color:#e6db74>&#34;New connection: 127.0.0.1:53721&#34;</span>, <span style=color:#f92672>&#34;session&#34;</span>: <span style=color:#e6db74>&#34;bbc88ffb69564ded87c48b6bc797f78c&#34;</span>, <span style=color:#f92672>&#34;sensor&#34;</span>: <span style=color:#e6db74>&#34;helium-cowrie&#34;</span>}</code></pre></div>
<h2 id=elk-elasticsearch-logstash-kibana>ELK (ElasticSearch, LogStash, Kibana)</h2>
<p>Now JSON logging is available, Cowrie includes sample configuration files for logstash and kibana
, to display honeypot data in a Kibana dashboard.</p>
<p>The nice thing about logstash is that it can do data enrichment offline. There&rsquo;s no need to configure GeoIP into Cowrie, just
load the IP data in logstash and enrich with GeoIP data such as country and city and ASN number from Maxmind:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{<span style=color:#f92672>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;New connection: 211.90.1.201:48353&#34;</span>,<span style=color:#f92672>&#34;@version&#34;</span>:<span style=color:#e6db74>&#34;1&#34;</span>,<span style=color:#f92672>&#34;@timestamp&#34;</span>:<span style=color:#e6db74>&#34;2015-02-04T20:49:01.717Z&#34;</span>,<span style=color:#f92672>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;127.0.0.1:55469&#34;</span>,<span style=color:#f92672>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;cowrie&#34;</span>,<span style=color:#f92672>&#34;src_ip&#34;</span>:<span style=color:#e6db74>&#34;211.90.1.201&#34;</span>,<span style=color:#f92672>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2015-02-04T20:49:01.717804Z&#34;</span>,<span style=color:#f92672>&#34;session&#34;</span>:<span style=color:#e6db74>&#34;6196432fa82c452e829f018caf04ba40&#34;</span>,<span style=color:#f92672>&#34;sensor&#34;</span>:<span style=color:#e6db74>&#34;helium-cowrie&#34;</span>,<span style=color:#f92672>&#34;geoip&#34;</span>:{<span style=color:#f92672>&#34;ip&#34;</span>:<span style=color:#e6db74>&#34;211.90.1.201&#34;</span>,<span style=color:#f92672>&#34;country_code2&#34;</span>:<span style=color:#e6db74>&#34;CN&#34;</span>,<span style=color:#f92672>&#34;country_code3&#34;</span>:<span style=color:#e6db74>&#34;CHN&#34;</span>,<span style=color:#f92672>&#34;country_name&#34;</span>:<span style=color:#e6db74>&#34;China&#34;</span>,<span style=color:#f92672>&#34;continent_code&#34;</span>:<span style=color:#e6db74>&#34;AS&#34;</span>,<span style=color:#f92672>&#34;latitude&#34;</span>:<span style=color:#ae81ff>35.0</span>,<span style=color:#f92672>&#34;longitude&#34;</span>:<span style=color:#ae81ff>105.0</span>,<span style=color:#f92672>&#34;location&#34;</span>:[<span style=color:#ae81ff>105.0</span>,<span style=color:#ae81ff>35.0</span>],<span style=color:#f92672>&#34;coordinates&#34;</span>:[<span style=color:#ae81ff>105.0</span>,<span style=color:#ae81ff>35.0</span>],<span style=color:#f92672>&#34;number&#34;</span>:<span style=color:#e6db74>&#34;AS4837&#34;</span>,<span style=color:#f92672>&#34;asn&#34;</span>:<span style=color:#e6db74>&#34;CNCGROUP China169 Backbone&#34;</span>}}
{<span style=color:#f92672>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;Client version: [SSH-2.0-libssh-0.1]&#34;</span>,<span style=color:#f92672>&#34;@version&#34;</span>:<span style=color:#e6db74>&#34;1&#34;</span>,<span style=color:#f92672>&#34;@timestamp&#34;</span>:<span style=color:#e6db74>&#34;2015-02-04T20:49:02.697Z&#34;</span>,<span style=color:#f92672>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;127.0.0.1:55469&#34;</span>,<span style=color:#f92672>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;cowrie&#34;</span>,<span style=color:#f92672>&#34;session&#34;</span>:<span style=color:#e6db74>&#34;6196432fa82c452e829f018caf04ba40&#34;</span>,<span style=color:#f92672>&#34;timestamp&#34;</span>:<span style=color:#e6db74>&#34;2015-02-04T20:49:02.697841Z&#34;</span>,<span style=color:#f92672>&#34;client&#34;</span>:<span style=color:#e6db74>&#34;SSH-2.0-libssh-0.1&#34;</span>,<span style=color:#f92672>&#34;sensor&#34;</span>:<span style=color:#e6db74>&#34;helium-cowrie&#34;</span>}</code></pre></div>
<p>If you then load data in a Kibana dashboard it should look something like this:</p>
<h2 id=shasums>SHAsums</h2>
<p>I ported katkad&rsquo;s SHAsum patches to log binaries, and made some modifications to consolidate the log messages.
Malware is now saved as its SHA-256 checksum, and only once per unique sample.</p>
<h1 id=roadmap--plans>Roadmap & Plans</h1>
<h2 id=logging>Logging</h2>
<p>Most of the current development plans focus on improving the logging. Currently the logging is unstructured text and there is even internal
log parsing with regexes to create database entries in some of the dblog modules. I&rsquo;d like to move to structured output formats to make
data easier to parse. The JSON output will improve and contain more data in structured fields.</p>
<h1 id=how-to-use>How to use</h1>
<p>To use Cowrie, simply copy from <a href=https://github.com/micheloosterhof/cowrie>https://github.com/micheloosterhof/cowrie</a>. The configuration is almost
a drop-in replacement for the original Kippo, with a few small changes to the configuration file.</p>
<p>Keep an eye out for these new options in your cowrie.cfg:
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text># JSON based logging module
[database_jsonlog]
logfile = log/cowrie.json

# Enables passing commands using ssh execCommand
# e.g. ssh root@localhost &lt;command&gt;
#
# (default: false)
exec_enabled = true

# sftp_enabled enables the sftp subsystem
sftp_enabled = true</code></pre></div></p>
<p>If you run into issues, feel free to get on touch on Twitter, check the current issues or create a new one.
Patches are also welcome.</p>
<ul class=pa0>
<li class="list di">
<a href=/tags/ssh class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">ssh</a>
</li>
<li class="list di">
<a href=/tags/cowrie class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">cowrie</a>
</li>
<li class="list di">
<a href=/tags/honeypot class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">honeypot</a>
</li>
</ul>
<div class="mt6 instapaper_ignoref">
</div>
</div>
<aside class="w-30-l mt6-l">
<div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
<p class="f5 b mb3">Related</p>
<ul class="pa0 list">
<li class=mb2>
<a href=/posts/2015-02-19-perl-stdin/>Interesting Perl scripts through stdin</a>
</li>
</ul>
</div>
</aside>
</article>
</main>
<footer class="bg-black bottom-0 w-100 pa3" role=contentinfo>
<div class="flex justify-between">
<a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://www.cowrie.org/>
&copy; Cowrie 2022
</a>
<div>
<div class=ananke-socials>
<a href=https://twitter.com/micheloosterhof target=_blank class="twitter ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel=noopener aria-label="follow on Twitter——Opens in a new window">
<span class=icon><svg style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</span>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</span></a>
<a href=https://github.com/cowrie/cowrie target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window">
<span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg>
</span>
<span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</span></a>
</div>
</div>
</div>
</footer>
</body>
</html>